function test_plcp_02_pass
%  double integrator example

%% input data
% min 0.5*U'*H*U + x'*F*U
% s.t.:  G*U <= W + E*x

H = [
   66.2631   50.2222   36.6812   24.1403   13.0994
   50.2222   43.0855   30.4488   20.3121   11.1754
   36.6812   30.4488   26.2163   16.4839    9.2514
   24.1403   20.3121   16.4839   14.6557    7.3274
   13.0994   11.1754    9.2514    7.3274    7.4035
];

F = [
  25.0818   18.2734   12.4649    7.6564    3.8480
  103.4443   82.1709   60.8976   40.6242   22.3508
];

G = [
         0         0         0         0         0
         0         0         0         0         0
    1.0000         0         0         0         0
   -1.0000         0         0         0         0
    0.5774         0         0         0         0
   -0.5774         0         0         0         0
         0    1.0000         0         0         0
         0   -1.0000         0         0         0
    0.5222    0.3482         0         0         0
   -0.5222   -0.3482         0         0         0
         0         0    1.0000         0         0
         0         0   -1.0000         0         0
    0.4815    0.3612    0.2408         0         0
   -0.4815   -0.3612   -0.2408         0         0
         0         0         0    1.0000         0
         0         0         0   -1.0000         0
         0         0         0         0    1.0000
         0         0         0         0   -1.0000
   -0.4070   -0.3549   -0.3027   -0.2506   -0.1985
    0.4070    0.3549    0.3027    0.2506    0.1985
];

E = [
 -1.0000         0
    1.0000         0
         0         0
         0         0
   -0.5774   -0.5774
    0.5774    0.5774
         0         0
         0         0
   -0.3482   -0.6963
    0.3482    0.6963
         0         0
         0         0
   -0.2408   -0.7223
    0.2408    0.7223
         0         0
         0         0
         0         0
         0         0
    0.1042    0.7097
   -0.1042   -0.7097];

W = [
    5.0000
    5.0000
    1.0000
    1.0000
    2.8868
    2.8868
    1.0000
    1.0000
    1.7408
    1.7408
    1.0000
    1.0000
    1.2039
    1.2039
    1.0000
    1.0000
    1.0000
    1.0000
    0.2006
    0.2006
];

% define problem
problem = Opt('H',H,'pF',F','A',G,'b',W,'pB',E);

% transform to LCP
% problem.qp2lcp;

% solve
res = problem.solve;

if res.xopt.Num~=25
    error('Wrong number of regions!');
end

% correct regions (as returned by MPT2.6)
P(1) = Polyhedron('H',[
   -0.483894526647507  -0.875126326355564   0.931022714305532
  -0.010097582583729  -0.999949018113406   1.888916045559476
   0.433142403030123  -0.901325500969151   3.208188917672285
   0.483894526647507   0.875126326355564   0.931022714305532
   0.010097582583729   0.999949018113406   1.888916045559476
  -0.433142403030123   0.901325500969151   3.208188917672285]);

P(2) = Polyhedron('H',[
-0.335442565973110  -0.942060658839640   1.284141394581968
   0.009973715738115   0.999950261260217   1.364977916322086
  -1.000000000000000                   0   5.000000000000000
   0.483894526647507   0.875126326355564  -0.931022714305532]);

P(3) = Polyhedron('H',[
     -0.397869439451612  -0.917442046753069   1.142367904058630
   0.270191450872693  -0.962806616032165   2.771691544407226
   0.010097582583729   0.999949018113406  -1.888916045559476]);

P(4) = Polyhedron('H',[
   0.066983629187291  -0.997754074620044   2.147109273197526
   0.611927526173580  -0.790913840257636   4.462838694646182
   0.457035016478525   0.889448702125353   0.790679443674812
   1.000000000000000                   0   5.000000000000000
  -0.433142403030123   0.901325500969151  -3.208188917672285]);

P(5) = Polyhedron('H',[
   -0.009973715738115  -0.999950261260217   1.364977916322086
   0.335442565973110   0.942060658839640   1.284141394581968
   1.000000000000000                   0   5.000000000000000
  -0.483894526647507  -0.875126326355564  -0.931022714305532]);

P(6) = Polyhedron('H',[
    0.397869439451612   0.917442046753069   1.142367904058630
  -0.270191450872693   0.962806616032165   2.771691544407226
  -0.010097582583729  -0.999949018113406  -1.888916045559476]); 

P(7) = Polyhedron('H',[
   -0.457035016478525  -0.889448702125353   0.790679443674812
  -0.066983629187291   0.997754074620044   2.147109273197526
  -0.611927526173580   0.790913840257636   4.462838694646182
  -1.000000000000000                   0   5.000000000000000
   0.433142403030123  -0.901325500969151  -3.208188917672285]);

P(8) = Polyhedron('H',[
   -0.253965080827879  -0.967213387893328   1.582811782077900
  -1.000000000000000                   0   5.000000000000000
   0.335442565973110   0.942060658839639  -1.284141394581968
   0.397869439451611   0.917442046753069  -1.142367904058630]);

P(9) = Polyhedron('H',[
   -1.000000000000000                   0   5.000000000000000
  -0.009973715738115  -0.999950261260216  -1.364977916322086
   0.457035016478525   0.889448702125353  -0.790679443674812]);

P(10) = Polyhedron('H',[
-0.327451416080973  -0.944868017294778   1.364763823982519
   0.419571060034850  -0.907722493706767   3.725146432022901
  -0.270191450872693   0.962806616032165  -2.771691544407226
  -0.066983629187291   0.997754074620044  -2.147109273197526]);

P(11) = Polyhedron('H',[
   0.135789468896689  -0.990737715107664   2.474265218566555
   1.000000000000000                   0   5.000000000000000
  -0.611927526173580   0.790913840257636  -4.462838694646181]);

P(12) = Polyhedron('H',[
   1.000000000000000                   0   5.000000000000000
  -0.457035016478525  -0.889448702125353  -0.790679443674812
   0.009973715738115   0.999950261260216  -1.364977916322086]);

P(13) = Polyhedron('H',[
    0.253965080827879   0.967213387893328   1.582811782077900
   1.000000000000000                   0   5.000000000000000
  -0.397869439451611  -0.917442046753069  -1.142367904058630
  -0.335442565973110  -0.942060658839639  -1.284141394581968]);

P(14) = Polyhedron('H',[
   0.327451416080973   0.944868017294778   1.364763823982519
  -0.419571060034850   0.907722493706767   3.725146432022901
   0.066983629187291  -0.997754074620044  -2.147109273197526
   0.270191450872693  -0.962806616032165  -2.771691544407226]);

P(15) = Polyhedron('H',[
 -0.135789468896689   0.990737715107664   2.474265218566554
  -1.000000000000000                   0   5.000000000000000
   0.611927526173580  -0.790913840257636  -4.462838694646182]);

P(16) = Polyhedron('H',[
 -0.203605953575316  -0.979052917706028   1.860325466559654
  -1.000000000000000                   0   5.000000000000000
   0.253965080827879   0.967213387893328  -1.582811782077900
   0.327451416080973   0.944868017294778  -1.364763823982519]);

P(17) = Polyhedron('H',[
-0.274954839082205  -0.961457142292510   1.580248928291771
   0.504334753195014  -0.863508226202695   4.821922387927509
   1.000000000000000                   0   5.000000000000000
  -0.419571060034850   0.907722493706767  -3.725146432022901
  -0.135789468896689   0.990737715107664  -2.474265218566554]);

P(18) = Polyhedron('H',[
   0.203605953575316   0.979052917706028   1.860325466559655
   1.000000000000000                   0   5.000000000000000
  -0.327451416080973  -0.944868017294778  -1.364763823982519
  -0.253965080827879  -0.967213387893328  -1.582811782077900]);

P(19) = Polyhedron('H',[ 
    0.274954839082205   0.961457142292509   1.580248928291771
  -0.504334753195014   0.863508226202695   4.821922387927508
  -1.000000000000000                   0   5.000000000000000
   0.135789468896689  -0.990737715107664  -2.474265218566555
   0.419571060034850  -0.907722493706767  -3.725146432022901]);

P(20) = Polyhedron('H',[
  -0.707106781186548  -0.707106781186547   4.242395759242187
  -0.169667712556354  -0.985501327911786   2.127773329418722
  -1.000000000000000                   0   5.000000000000000
   0.203605953575316   0.979052917706028  -1.860325466559655
   0.274954839082205   0.961457142292510  -1.580248928291771]);

P(21) = Polyhedron('H',[
-0.235639014345306  -0.971840653048828   1.788832113055491
   1.000000000000000                   0   5.000000000000000
  -0.504334753195014   0.863508226202695  -4.821922387927509]);

P(22) = Polyhedron('H',[
   0.707106781186548   0.707106781186547   4.242395759242191
   0.169667712556354   0.985501327911787   2.127773329418722
   1.000000000000000                   0   5.000000000000000
  -0.274954839082205  -0.961457142292509  -1.580248928291771
  -0.203605953575316  -0.979052917706028  -1.860325466559655]);

P(23) = Polyhedron('H',[
  0.235639014345306   0.971840653048828   1.788832113055492
  -1.000000000000000                   0   5.000000000000000
   0.504334753195014  -0.863508226202695  -4.821922387927508]);

P(24) = Polyhedron('H',[
  -0.707106781186548  -0.707106781186547   4.242395759242190
  -0.447264975000445  -0.894401499404966   3.354101960715570
  -0.145265217278462  -0.989392751463766   2.389905585225220
   1.000000000000000                   0   5.000000000000000
   0.169667712556354   0.985501327911786  -2.127773329418723
   0.235639014345306   0.971840653048828  -1.788832113055491]);

P(25) = Polyhedron('H',[
   0.707106781186548   0.707106781186547   4.242395759242187
   0.447264975000444   0.894401499404966   3.354101960715564
   0.145265217278462   0.989392751463766   2.389905585225216
  -1.000000000000000                   0   5.000000000000000
  -0.235639014345306  -0.971840653048828  -1.788832113055491
  -0.169667712556354  -0.985501327911786  -2.127773329418722]);

% compare each region with each
for i=1:25
    v = false(1,25);
    for j=1:25
        % testing by inequality is less numerically sensitive as equality
        %v(j) = (res.xopt.Set(i)<=P(j)) || (P(j)<=res.xopt.Set(i));
        v(j) = res.xopt.Set(i)==P(j);
    end
    % only one region must me active 
    if nnz(v)~=1
        error('Regions of the computed solution do not match.');
    end
end

